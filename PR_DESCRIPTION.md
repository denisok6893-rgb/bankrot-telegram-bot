# –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º

## üìã –û–±–∑–æ—Ä

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö, –≤–∞–∂–Ω—ã—Ö –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º. –ü—Ä–æ–µ–∫—Ç –ø—Ä–æ—à–µ–ª 3 —ç—Ç–∞–ø–∞ —É–ª—É—á—à–µ–Ω–∏–π.

---

## üî¥ –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### Undefined —Ñ—É–Ω–∫—Ü–∏–∏ (NameError)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ `send_creditors_menu()` - helper –¥–ª—è –º–µ–Ω—é –∫—Ä–µ–¥–∏—Ç–æ—Ä–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ `docs_choose_case()` - –≤—ã–±–æ—Ä –¥–µ–ª–∞ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ `cases_menu_ikb()` - –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –º–µ–Ω—é "–î–µ–ª–∞"

### –ú–µ—Ä—Ç–≤—ã–π –∫–æ–¥
- ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ `_old_build_bankruptcy_petition_doc` ‚Üí `build_bankruptcy_petition_doc`
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ `_old_build_docx_from_template`
- ‚úÖ –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç `InlineKeyboardBuilder`

### –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–∞ `validate_case_card` (—É–±—Ä–∞–Ω–∞ –≤–µ—Ä—Å–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è list)
- ‚úÖ –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–∞ `upsert_case_card` (—É–±—Ä–∞–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –£–¥–∞–ª–µ–Ω `ssl=False` –∏–∑ `gigachat.py` (—Å—Ç—Ä–æ–∫–∏ 36, 84)

**–§–∞–π–ª—ã:** bot.py (-152 —Å—Ç—Ä–æ–∫–∏), keyboards/menus.py (+10), gigachat.py
**–ö–æ–º–º–∏—Ç:** `4e8191f`

---

## üü† –≠—Ç–∞–ø 2: –í–∞–∂–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (16 –º–µ—Å—Ç)
–ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ `except Exception:` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã:
- `ValueError, TypeError` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ –≤ —á–∏—Å–ª–∞ (6 –º–µ—Å—Ç)
- `json.JSONDecodeError` - –ø–∞—Ä—Å–∏–Ω–≥ JSON (2 –º–µ—Å—Ç–∞)
- `KeyError, TypeError, AttributeError` - —Ä–∞–±–æ—Ç–∞ —Å dict (6 –º–µ—Å—Ç)
- `IndexError, TypeError` - –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ tuple (1 –º–µ—Å—Ç–æ)
- `ImportError, ModuleNotFoundError` - –∏–º–ø–æ—Ä—Ç—ã (1 –º–µ—Å—Ç–æ)

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `logger` –≤ bot.py –∏ docs_builder.py
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:
  ```python
  logger.warning(f"Failed to build attachments: {e}")
  logger.error(f"Failed to parse JSON for case_id={cid}: {e}")
  ```

### –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏ (4 –º–µ—Å—Ç–∞)
```python
# –ë—ã–ª–æ
/root/bankrot_bot/bankrot.db

# –°—Ç–∞–ª–æ
project_root = Path(__file__).parent.resolve()
os.getenv("DB_PATH") or str(project_root / "bankrot.db")
```

**–§–∞–π–ª—ã:** config.py, logging_setup.py, cases.py

### Wildcard –∏–º–ø–æ—Ä—Ç
```python
# –ë—ã–ª–æ
from menus import *  # noqa

# –°—Ç–∞–ª–æ
from menus import (
    main_menu_kb, start_ikb, home_ikb,
    # ... 12 —Ñ—É–Ω–∫—Ü–∏–π
)
```

**–§–∞–π–ª—ã:** bot.py, blocks.py, docs_builder.py (+7 —Ñ–∞–π–ª–æ–≤)
**–ö–æ–º–º–∏—Ç:** `5c41ed1`

---

## üü° –≠—Ç–∞–ø 3: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –¢–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `InlineKeyboardMarkup` –≤ –∏–º–ø–æ—Ä—Ç—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã return types –¥–ª—è –≤—Å–µ—Ö keyboard —Ñ—É–Ω–∫—Ü–∏–π (6 —à—Ç):
  - `main_keyboard() -> InlineKeyboardMarkup`
  - `export_keyboard() -> InlineKeyboardMarkup`
  - `court_type_keyboard() -> InlineKeyboardMarkup`
  - –∏ –¥—Ä.

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
–î–æ–±–∞–≤–ª–µ–Ω—ã docstrings –∫ –∫–ª—é—á–µ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º:
```python
def list_cases(owner_user_id: int, limit: int = 20) -> List[Tuple]:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Args:
        owner_user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–≤–ª–∞–¥–µ–ª—å—Ü–∞
        limit: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–ª

    Returns:
        –°–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π: (id, code_name, case_number, stage, updated_at)
    """
```

**–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏:**
- `list_cases()`, `get_case()`, `get_profile()`
- `validate_case_card()`, `get_case_card()`
- `_compose_debtor_full_name()`
- –í—Å–µ keyboard —Ñ—É–Ω–∫—Ü–∏–∏

### –ù–æ–≤—ã–π –º–æ–¥—É–ª—å utils.py
–í—ã–Ω–µ—Å–µ–Ω—ã helper —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `bankrot_bot/utils.py` (111 —Å—Ç—Ä–æ–∫):
- `format_creditor_line()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ—Ä–∞
- `humanize_missing_fields()` - —á–∏—Ç–∞–µ–º—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π
- `calculate_card_completion()` - –ø–æ–¥—Å—á–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏
- `safe_digits()` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–∏—Ñ—Ä

**–§–∞–π–ª—ã:** bot.py (+54 —Å—Ç—Ä–æ–∫–∏), utils.py (–Ω–æ–≤—ã–π, +111 —Å—Ç—Ä–æ–∫)
**–ö–æ–º–º–∏—Ç:** `9130d1e`

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ò–∑–º–µ–Ω–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: 10
- bot.py
- bankrot_bot/keyboards/menus.py
- bankrot_bot/services/gigachat.py
- bankrot_bot/services/blocks.py
- bankrot_bot/services/docs_builder.py
- bankrot_bot/config.py
- bankrot_bot/logging_setup.py
- bankrot_bot/utils.py (–Ω–æ–≤—ã–π)
- cases.py
- keyboards.py

### –ú–µ—Ç—Ä–∏–∫–∏
- –î–æ–±–∞–≤–ª–µ–Ω–æ: ~320 —Å—Ç—Ä–æ–∫
- –£–¥–∞–ª–µ–Ω–æ: ~180 —Å—Ç—Ä–æ–∫
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: 16 bare except –±–ª–æ–∫–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–æ: 12+ docstrings
- –°–æ–∑–¥–∞–Ω–æ: 1 –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- ‚úÖ –ù–µ—Ç undefined —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ SSL –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞
- ‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- ‚úÖ –ù–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—É—Ç–µ–π

### –°–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ–º–æ—Å—Ç—å
- ‚úÖ –ß–∏—Ç–∞–µ–º—ã–π –∫–æ–¥
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –Ø–≤–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–µ–ª
2. ‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–µ–ª
3. ‚úÖ –†–∞–±–æ—Ç—É —Å –∫—Ä–µ–¥–∏—Ç–æ—Ä–∞–º–∏
4. ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
5. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

---

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:
- API —Ñ—É–Ω–∫—Ü–∏–π –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
- –ü–æ–≤–µ–¥–µ–Ω–∏–µ –±–æ—Ç–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ

---

## üìù –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –±—É–¥—É—â–∏—Ö —ç—Ç–∞–ø–æ–≤ –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å:
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ bot.py –Ω–∞ –º–æ–¥—É–ª–∏ handlers/
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î (Alembic)
- –ü–µ—Ä–µ–Ω–æ—Å –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ Redis/FSM
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ unit-—Ç–µ—Å—Ç–æ–≤
- CI/CD pipeline
